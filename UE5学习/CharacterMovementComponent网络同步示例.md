# CharacterMovementComponent网络同步示例

### 移动简要流程

自主代理
1. 本地执行移动逻辑，将移动数据加入队列
2. 将移动数据通过RPC发送至服务端

服务端
1. 服务端通过客户端RPC的数据**再现移动**
2. 再现失败则发送纠正数据包到自主代理客户端，客户端使用服务端返回的数据，替换savedmoved队列进行replay
3. 再现成功则发送移动有效RPC，客户端清除savemoved队列中的历史移动信息

模拟代理(其他客户端)
1. 模拟代理完全使用服务端的移动复制数据（不进行模拟物理移动）

### 问题一：在离散的网络同步下如何实现连续的移动效果？

1. 自主代理使用**本地预测**实现连续的移动效果
2. 权威服务端按照自主代理提供的移动数据做再现
3. 如果无法再现，则向自主代理发出纠正
4. 模拟代理完全使用服务端复制的数据，连续的移动通过**网络平滑**实现(插值)


### 问题二：本地的SavedMoves 队列是什么？作用是什么？

记录角色移动的历史状态，包括移动位置，速度，加速度，时间戳。

用于客户端做预测，服务端做判断和修正，通过修复SaveMoves队列，实现客户端移动的纠正，使客户端的移动数据按照SaveMoves Replay至服务端状态。

[参考](https://dev.epicgames.com/documentation/zh-cn/unreal-engine/API/Runtime/Engine/GameFramework/FSavedMove_Character)

### 问题三：网络平滑是什么？怎么实现的？

插值

### 问题四：自主代理向服务端发送的移动数据RPC包含什么内容？服务端是否模拟物理移动？

包含：
1. 客户端Actor的最终位置，旋转信息
2. 捕获移动输入
3. 速度与加速度
4. 根骨骼运动信息（这是什么？）

服务端会模拟物理移动，从而检测客户端的移动是否有效

### 问题五：服务端纠正客户端移动信息的条件是什么？

1. 移动最终位置是否大于误差值
2. 

